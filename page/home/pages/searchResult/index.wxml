<wxs src="../../../../utils/common.wxs" module="c"/>
<i-toast id="toast"/>
<i-message id="message"/>
<view class="azm-home-searchResult">
    <view id="azm-header">
        <view class="azm-search flexBox flexBox-start azm-1px-b">
            <view class="flexBox azm-search-l">
                <input type="text" value="{{search}}" placeholder="找店铺 找服务 找案例" maxlength="12"
                       confirm-type="search" bindconfirm="doSearch" bindinput="bindSearchInput"/>
                <icon type="search" class="azm-icon-search" size="12"/>
            </view>
            <view class="flexBox azm-search-r">
                <button class="azm-btn-search-cancel" size="mini" plain bindtap="bindSearchCancel" hover-class="none">
                    <text>取消</text>
                </button>
            </view>
        </view>
        <i-tabs current="tab{{ current }}" color="#ff538b" bindchange="handleTabChange">
            <i-tab wx:for="{{tabList}}" wx:key="{{index}}" key="{{item.key}}" title="{{item.title}}"></i-tab>
        </i-tabs>
    </view>
    <view id="azm-content-box">
        <swiper class="azm-content" style="{{ styleSwiper }}" bindchange="bindSwiperChange" current="{{current}}">
            <swiper-item>
                <scroll-view scroll-y scroll-with-animation enable-back-to-top bindscrolltoupper="upper0"
                             bindscrolltolower="lower0" style="height: 100%" upper-threshold="{{ scrollTop0 }}"
                             bindscroll="bindTabScroll0" scroll-into-view="{{tab0View}}" scroll-top="{{scrollTop0}}">
                    <i-message id="message0"/>
                    <view id="azm-refresh0" class="azm-refresh">
                        <view class="azm-refresh-box" wx:if="{{false}}">
                            <block wx:if="{{tab0TopStep === 2}}">
                                <text class="azm-iconfont azm-icon icon-jiazai"></text>
                                <text decode>&nbsp;&nbsp;刷新中</text>
                            </block>
                            <block wx:elif="{{tab0TopStep === 1}}">
                                <text class="azm-iconfont azm-icon icon-refreshup"></text>
                                <text decode>&nbsp;松开刷新</text>
                            </block>
                            <block wx:else>
                                <text class="iconfont azm-icon icon-down-arrow"></text>
                                <text decode>&nbsp;下拉刷新</text>
                            </block>
                        </view>
                    </view>
                    <view id="tab0" style="{{styleMinH}}">
                        <block wx:if="{{shopList&&shopList.length>0}}">
                            <block wx:for="{{shopList}}" wx:key="{{i}}" wx:for-item="list" wx:for-index="i">
                                <view class="flexBox flexBox-start azm-1px-b" wx:for="{{list}}" wx:key="{{index}}">
                                    <view class="flexBox-item azm-tab0-l">
                                        <azm-image ratio="1" src="{{item.cover}}" class="azm-image-box" type="img"
                                                   lazy-load="true" mode="aspectFill"></azm-image>
                                    </view>
                                    <view class="flexBox-item azm-tab0-r" bindtap="toShopDetail" data-id="{{item.id}}">
                                        <view class="azm-tab0-title">{{item.shop_name}}</view>
                                        <view class="azm-tab0-stars flexBox flexBox-start">
                                            <view class="flexBox-item">
                                                <wxc-rate value="{{item.score}}" readonly padding="10"
                                                          size="28"></wxc-rate>
                                            </view>
                                            <view class="flexBox-item">
                                                <text>{{item.loved_count}}人喜欢</text>
                                            </view>
                                        </view>
                                        <wxc-label class="azm-tab0-label" type="corner" text="{{item.major_category}}"
                                                   type-color="#f4f4f4" text-color="#999999"></wxc-label>
                                        <view class="azm-tab0-location">
                                            <text>{{item.position_name}}{{item.distance}}</text>
                                        </view>
                                    </view>
                                </view>
                            </block>
                        </block>
                        <view wx:else class="azm-no-data">
                            <wxc-abnor type="REQUEST_ERROR" image="https://app.mmtcapp.com/mmtc/imgs/empty.png"
                                       title="抱歉！没有找到相关店铺~" tip="" button="点击刷新" bind:abnortap="onAbnorTap"></wxc-abnor>
                        </view>
                    </view>
                    <view class="azm-load-more">
                        <block wx:if="{{shopList && shopList.length>0}}">
                            <wxc-loadmore is-end="{{noMore0}}" icon="随机/loading"></wxc-loadmore>
                        </block>
                    </view>
                </scroll-view>
            </swiper-item>
            <swiper-item>
                <scroll-view scroll-y scroll-with-animation enable-back-to-top bindscrolltoupper="upper1"
                             bindscrolltolower="lower1" style="height: 100%"
                             bindscroll="bindTabScroll1" scroll-into-view="{{tab1View}}" scroll-top="{{scrollTop1}}">
                    <i-message id="message1"/>
                    <view id="azm-refresh1" class="azm-refresh">
                        <view class="azm-refresh-box" wx:if="{{false}}">
                            <block wx:if="{{tab1TopStep === 2}}">
                                <text class="azm-iconfont azm-icon icon-jiazai"></text>
                                <text decode>&nbsp;&nbsp;刷新中</text>
                            </block>
                            <block wx:elif="{{tab1TopStep === 1}}">
                                <text class="azm-iconfont azm-icon icon-refreshup"></text>
                                <text decode>&nbsp;松开刷新</text>
                            </block>
                            <block wx:else>
                                <text class="iconfont azm-icon icon-down-arrow"></text>
                                <text decode>&nbsp;下拉刷新</text>
                            </block>
                        </view>
                    </view>
                    <view id="tab1" style="{{styleMinH}}">
                        <block wx:if="{{itemList&&itemList.length>0}}">
                            <block wx:for="{{itemList}}" wx:key="{{i}}" wx:for-item="list" wx:for-index="i">
                                <view class="flexBox flexBox-start" wx:for="{{c.itemArrSplit(list)}}"
                                      wx:for-item="arr" wx:for-index="j" wx:key="{{j}}">
                                    <view class="flexBox-item fb-12" wx:for="{{arr}}" wx:key="{{index}}">
                                        <view class="azm-item__box" bindtap="toItemDetail" data-id="{{item.id}}">
                                            <view class="azm-group-num" wx:if="{{item.group_num>0}}">
                                                <text>{{item.group_num}}人团</text>
                                            </view>
                                            <azm-image ratio="1" src="{{item.cover}}" class="azm-image-box" type="img"
                                                       lazy-load="true" mode="aspectFill"></azm-image>
                                            <view class='azm-item-info'>
                                                <view class="azm-item-title zan-ellipsis">{{item.title}}</view>
                                                <view class="azm-item-desc zan-ellipsis">
                                                    <text>{{item.profile||'专家设计，节假日通用'}}</text>
                                                </view>
                                                <view class="azm-item-price-info zan-ellipsis">
                                                    <block wx:if="{{item.group_num && item.group_num>0}}">
                                                        <view class="price">
                                                            <i>拼团价￥</i>
                                                            <span>{{item.group_price}}</span>
                                                        </view>
                                                        <view class='market-price'>
                                                            ¥{{item.price}}
                                                        </view>
                                                    </block>
                                                    <block wx:else>
                                                        <view class="price">
                                                            <i>￥</i>
                                                            <span>{{item.price}}</span>
                                                        </view>
                                                        <view class='market-price'>
                                                            ¥{{item.market_price}}
                                                        </view>
                                                    </block>
                                                </view>
                                            </view>
                                        </view>
                                    </view>
                                </view>
                            </block>
                        </block>
                        <view wx:else class="azm-no-data">
                            <wxc-abnor type="REQUEST_ERROR" image="https://app.mmtcapp.com/mmtc/imgs/empty.png"
                                       title="抱歉！没有找到相关服务~" tip="" button="点击刷新" bind:abnortap="onAbnorTap"></wxc-abnor>
                        </view>
                    </view>
                    <view class="azm-load-more">
                        <block wx:if="{{itemList && itemList.length>0}}">
                            <wxc-loadmore is-end="{{noMore1}}" icon="随机/loading"></wxc-loadmore>
                        </block>
                    </view>
                </scroll-view>
            </swiper-item>
            <swiper-item>
                <scroll-view scroll-y scroll-with-animation enable-back-to-top bindscrolltoupper="upper2"
                             bindscrolltolower="lower2" style="height: 100%"
                             bindscroll="bindTabScroll2" scroll-into-view="{{tab2View}}" scroll-top="{{scrollTop2}}">
                    <i-message id="message2"/>
                    <view id="azm-refresh2" class="azm-refresh">
                        <view class="azm-refresh-box" wx:if="{{false}}">
                            <block wx:if="{{tab1TopStep === 2}}">
                                <text class="azm-iconfont azm-icon icon-jiazai"></text>
                                <text decode>&nbsp;&nbsp;刷新中</text>
                            </block>
                            <block wx:elif="{{tab1TopStep === 1}}">
                                <text class="azm-iconfont azm-icon icon-refreshup"></text>
                                <text decode>&nbsp;松开刷新</text>
                            </block>
                            <block wx:else>
                                <text class="iconfont azm-icon icon-down-arrow"></text>
                                <text decode>&nbsp;下拉刷新</text>
                            </block>
                        </view>
                    </view>
                    <view id="tab2" style="{{styleMinH}}">
                        <block wx:if="{{noteList&&noteList.length>0}}">
                            <block wx:for="{{noteList}}" wx:key="{{i}}" wx:for-item="list" wx:for-index="i">
                                <i-panel wx:for="{{list}}" wx:key="{{index}}" class="azm-tab2-box" hide-border
                                         bindtap="toNoteDetail" data-id="{{item.id}}">
                                    <view class="flexBox flexBox-start azm-note-title">
                                        <view class="flexBox-item azm-title-avatar">
                                            <azm-image ratio="1" src="{{item.avatar}}" class="azm-image-box" type="img"
                                                       lazy-load="true" mode="aspectFill"></azm-image>
                                        </view>
                                        <view class="flexBox-item azm-title-r">
                                            <view class="azm-nickName">{{item.nickname}}</view>
                                            <view class="azm-create-time">{{item.create_time}}</view>
                                        </view>
                                    </view>
                                    <view class="flexBox flexBox-start azm-note-image">
                                        <view class="flexBox-item fb-12">
                                            <azm-image wx:if="{{c.str2attr(item.img_src)[0]}}" ratio="1"
                                                       src="{{c.str2attr(item.img_src)[0]}}"
                                                       class="azm-image-box" type="img"
                                                       lazy-load="true" mode="aspectFill"></azm-image>
                                        </view>
                                        <view class="flexBox-item fb-12">
                                            <azm-image wx:if="{{c.str2attr(item.img_src)[1]}}" ratio="1"
                                                       src="{{c.str2attr(item.img_src)[1]}}"
                                                       class="azm-image-box" type="img"
                                                       lazy-load="true" mode="aspectFill"></azm-image>
                                        </view>
                                    </view>
                                    <view class="azm-note-content">{{item.content}}</view>
                                    <view class="flexBox azm-note-footer azm-1px-b azm-1px-t" catchtap="stopTap">
                                        <view class="flexBox-item fb-8 azm-1px-r">
                                            <text class="iconfont icon-liulan azm-icon"></text>
                                            <text class="azm-text" decode>&nbsp;浏览&nbsp;</text>
                                            <text class="azm-num">{{item.viewed_count}}</text>
                                        </view>
                                        <view class="flexBox-item fb-8 azm-1px-r {{c.zanClass(item,noteZan)}}"
                                              catchtap="zan" data-item="{{item}}" data-page="{{i}}"
                                              data-index="{{index}}">
                                            <text class="iconfont icon-iconfontzhizuobiaozhun023148 azm-icon"></text>
                                            <text class="azm-text" decode>&nbsp;点赞&nbsp;</text>
                                            <text class="azm-num">{{item.zan_count}}</text>
                                        </view>
                                        <view class="flexBox-item fb-8">
                                            <text class="iconfont icon-pinglun azm-icon"></text>
                                            <text class="azm-text" decode>&nbsp;评论&nbsp;</text>
                                            <text class="azm-num">{{item.comment_count}}</text>
                                        </view>
                                    </view>
                                </i-panel>
                            </block>
                        </block>
                        <view wx:else class="azm-no-data">
                            <wxc-abnor type="REQUEST_ERROR" image="https://app.mmtcapp.com/mmtc/imgs/empty.png"
                                       title="抱歉！没有找到相关服务~" tip="" button="点击刷新" bind:abnortap="onAbnorTap"></wxc-abnor>
                        </view>
                    </view>
                    <view class="azm-load-more">
                        <block wx:if="{{noteList && noteList.length>0}}">
                            <wxc-loadmore is-end="{{noMore2}}" icon="随机/loading"></wxc-loadmore>
                        </block>
                    </view>
                </scroll-view>
            </swiper-item>
        </swiper>
    </view>
</view>
