<wxs src="../../utils/common.wxs" module="c" />
<wxs module="f">
  module.exports = {
    num2arr: function(strs) {
      if (strs) {
        strs = strs.split(',');
        if (strs.length > 3) {
          strs = strs.slice(0, 3);
        }
        return strs;
      }
      return [];
    },

    num2score: function(num, attrlen) {
      attrlen = attrlen || 5;
      num = parseInt(num);
      var rt = [];
      for (var i = 0; i < 5; i++) {
        if (i < num) {
          rt.push(1);
        } else {
          rt.push(0);
        }
      }
      return rt;
    },
    discount: function(v) {
      return v.split(':')[1] || '';
    },
    split: function(str) {
      var rt = str.split(',');
      if (rt.length > 2) {
        return rt.slice(0, 2);
      }
      return rt;
    },

    picCount: function(strs) {
      if (strs) {
        strs = strs.split(',');
        if (strs.length > 3) {
          return 3;
        }
        return strs.length;
      }
      return 0;
    }
  }
</wxs>
<view class='toobar-wrap'>
  <view class="p1 border-b">
    <view class='flex'>
      <view class='search flex-con rel'>
        <image src='https://app.mmtcapp.com/mmtc/imgs/search@2x.png' style='width: 24rpx;	height: 24rpx' class='search-img'></image>
        <input class='search-input' value="{{kw}}" confirm-type="search" bindconfirm="doSearch" placeholder='找服务 找店铺 找案例'></input>
      </view>
      <view class='cancel-text' bindtap='cancelSearch'>
        取消
      </view>
    </view>
  </view>
  <view class='toobar border-b'>
    <view class="flex">
      <view data-id="1" bindtap='toggleType' class='flex-con border-r {{type==1?"active":""}}'>
        店铺
      </view>
      <view data-id="0" bindtap='toggleType' class='flex-con border-r {{type==0?"active":""}}'>
        服务
      </view>
      <view data-id="2" bindtap='toggleType' class='flex-con {{type==2?"active":""}}'>
        案例
      </view>
    </view>
  </view>
</view>
<view class='hr'></view>
<view class='box3 bg-white' wx:if="{{type==0}}">
  <navigator url='/pages/item/detail?id={{item.id}}' hover-class='none' class='box3-item' wx:key="item.id" wx:for="{{items}}" wx:for-index="index" wx:for-item="item">
    <view class="box3-group-num" wx:if="{{item.group_num && item.group_num>0}}">{{item.group_num}}人团</view>
    <image src="{{c.absUrl(item.cover,400)}}" class="cover" background-size="cover"></image>
    <view class='box3-item-info'>
      <view class="box3-item-title one-line">{{item.title}}</view>
      <view class="box3-item-desc one-line">{{item.profile||'专家设计，节假日通用'}}</view>
      <view class="box3-item-price-info one-line">
        <block wx:if="{{item.group_num && item.group_num>0}}">
          <view class="price">
            <i>拼团价￥</i>
            <span>{{item.group_price}}</span>
          </view>
          <view class='market-price'>
            ¥{{item.price}}
          </view>
        </block>
        <block wx:else>
          <view class="price">
            <i>￥</i>
            <span>{{item.price}}</span>
          </view>
          <view class='market-price'>
            ¥{{item.market_price}}
          </view>
        </block>
      </view>
    </view>
  </navigator>
</view>

<view class='list-box' wx:elif="{{type==1}}">
  <view class='list-box-item border-b' wx:for="{{items}}" wx:key="id" data-id="{{item.id}}" bindtap='showShopDetail'>
    <view class='flex flex-stretch'>
      <view>
        <image src='{{c.absUrl(item.cover,200)}}' class='shop-cover'></image>
      </view>
      <view class='flex-con'>
        <view class='shop-info'>
          <view>
            <view class='shop-title one-line'>{{item.shop_name}}</view>
            <view class='stars'>
              <block wx:for="{{f.num2score(item.score)}}" wx:for-item="i" wx:key="index">
                <image src="{{'https://app.mmtcapp.com/mmtc/imgs/start'+(i?1:2)+'@2x.png'}}"></image>
              </block>
            </view>
            <view class='ib fz24 text999'>
              {{item.loved_count||0}}人喜欢
            </view>
          </view>
          <view class='tags' wx:if="{{item.major_category}}">
            <view class='tag' wx:key="index" wx:for="{{f.split(item.major_category)}}" wx:for-item="cc">{{cc}}</view>
          </view>
          <view class='flex'>
            <view class='distance flex-con'>
              <view class='flex'>
                <view class='one-line'>{{item.position_name}}</view>
                <view class='nowrap'>
                  {{item.distance}}
                </view>
              </view>
            </view>
            <view>
              <view class='bought-area' wx:if="{{item.discount_type>0}}">
                <view wx:if="{{item.discount_type==1}}">
                  买单
                  <view class='zk'>{{item.discount}}</view>
                  折
                </view>
                <view wx:else>
                  立减
                  <b class="zk">{{f.discount(item.discount)}}</b>元
                </view>
              </view>
            </view>
          </view>
          <view class='discount' wx:if="{{item.has_group>0}}">
            <view class='discount-icon'>拼</view>
            拼团享优惠
          </view>
        </view>
      </view>
    </view>
  </view>
</view>
<view wx:elif="{{type==2}}">
  <view wx:key="id" wx:for="{{items}}" class="note-item">
    <view class="p30">
      <view class="flex">
        <view>
          <image class="avatar" src="{{c.absUrl(item.avatar,200) || 'https://app.mmtcapp.com/mmtc/imgs/default.png'}}"></image>
        </view>
        <view class="flex-con">
          <view class="fz32 text282828">{{item.nickname}}</view>
          <view class="text999 fz24 pt10">{{item.create_time}}</view>
        </view>
      </view>
      <navigator url="/pages/cases/detail?id={{item.id}}" hover-class="none">
        <block wx:if="{{item.img_src}}">
          <view class="pic-list{{f.picCount(item.img_src)}}">
            <image src='{{c.absUrl(pic,400)}}' wx:for="{{f.num2arr(item.img_src)}}" wx:key="*this" wx:for-item="pic"></image>
          </view>
        </block>
        <view class="fz28 content two-line">
          {{item.content}}
        </view>
      </navigator>
      <view wx:if="{{item.item_id && item.item_id > 0}}" class="pt20">
        <image src="https://app.mmtcapp.com/mmtc/imgs/clz@2x.png" class="img-sm"></image>
        <view class="color-red fz26 ib pl10" bindtap='showItemDetail' data-id="{{item.item_id}}">{{item.item_title}}</view>
      </view>
    </view>
    <view class="flex border-t toolbar-mini text666 fz24 text-center bg-white border-b">
      <view class="flex-con border-r">
        <image src="https://app.mmtcapp.com/mmtc/imgs/eye@2x.png" alt="" class='view-img'></image>
        浏览 {{item.viewed_count}}
      </view>
      <view class="flex-con border-r {{c.zanedClass(item)}}" catchtap='zan' data-id="{{item.id}}">
        <image src="https://app.mmtcapp.com/mmtc/imgs/zan{{item.zaned?'1':''}}@2x.png" alt="" class='zan-img'></image>
        点赞 {{item.zan_count}}
      </view>
      <view class="flex-con" tapmode="hover">
        <image src="https://app.mmtcapp.com/mmtc/imgs/msg@2x.png" alt="" class='comment-img'></image>
        评论 {{item.comment_count}}
      </view>
    </view>
  </view>
</view>
<view class='empty-area' wx:if="{{isEmpty}}">
  <image src='https://app.mmtcapp.com/mmtc/imgs/empty@2x.png'></image>
  <view class='text-center'>
    ops，这里空空如也，逛逛其他的吧~
  </view>
</view>
<image id="gotoTop" hidden='{{!topFixed}}' src='https://app.mmtcapp.com/mmtc/imgs/top.png' bindtap='gotoTop'></image>
<include src="../common/more.wxml"></include>